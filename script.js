const NAMES = [
  "1Dont3now_tv",
  "1ns0mn1a_bot",
  "20JP",
  "21PilotLyfe",
  "2hnoah",
  "303_Gaming",
  "5unah",
  "6abz",
  "6kid",
  "6ossuxa",
  "9222",
  "_VES",
  "A_Quip",
  "Aaronblatt",
  "abblebeezz",
  "AbiCoops",
  "Acid_Pie",
  "AdamnAdam",
  "AdamNotAvailable",
  "AdamPlays",
  "Agourk",
  "Agroed",
  "Ah0j",
  "AhinaHayamaTTV",
  "AHRCEUS",
  "airyawn",
  "Aiyri",
  "Ajaxmvb",
  "akc0303",
  "Akirini",
  "ALBrassard",
  "Aliface",
  "AlinaOverpowered",
  "allthatchelsea",
  "AlphaFounded",
  "Alphyre_YT",
  "Alsogone",
  "AltemusX",
  "Altermond",
  "aluee",
  "Alzakz",
  "Am_ehx",
  "Ambicioso",
  "Amisu",
  "Amzo_",
  "An_Accountant",
  "Anchyuwu",
  "AnEmily",
  "Anfasith",
  "AnibaeVT",
  "Anima_Ryuu",
  "AnkaaGrey",
  "ann3xiety",
  "Annekie",
  "Anniel96",
  "annupoica",
  "Antonisu",
  "AntToesKnees",
  "Aopks",
  "Apollo30",
  "AppleW",
  "aprilmaple5620",
  "Aprite",
  "ARareLemon",
  "AriesAkana",
  "Arin524",
  "arrf",
  "Aryxion",
  "Asaf_Playz",
  "AshBroz1234",
  "ashsart23",
  "Ashuen",
  "Aslinxzz",
  "AsoEu",
  "AstraCA",
  "AStrangeCreature",
  "Asttaroth",
  "asvuep",
  "Atomsee",
  "AuddRee",
  "Aulig",
  "Aur1e",
  "AuroraKatVA",
  "avieluu",
  "Avoma",
  "aw3someg1rl",
  "awesomeness0880",
  "AwsomeHoneyDog",
  "Ax0lott",
  "ayqh",
  "b00fswag",
  "babyorbii",
  "BadRexx",
  "Balc0n",
  "BatzyBear",
  "bearbubb",
  "Bearcraft02",
  "bebopskye",
  "beefyboulevard",
  "BeeinT",
  "beepbeep_cheeryo",
  "BenDotEXE",
  "Berna7224",
  "Bimpy416",
  "Bingostill",
  "BinnBean",
  "bipolarobot",
  "Bittersw3et",
  "Bizzy_Brit",
  "Blinci",
  "BlitzStream",
  "bluetenmeer",
  "bolh3h",
  "BombsterG",
  "BonkersJack",
  "BooPenelopeApple",
  "BottledSalad",
  "BowlV2",
  "BOX_Eggsotic",
  "boysbehating",
  "braedy12",
  "BrasenPlayz",
  "BreadleyYourHero",
  "britknees",
  "Broodling",
  "BROWN_YT",
  "Bumpkin_Boii",
  "Bun_Bunana",
  "BunnMom",
  "Busvicke123",
  "ButtonMash5000",
  "Byzantonia",
  "caiuwus",
  "callkhada",
  "CallMeCass",
  "CaluMerge",
  "CamYeaaH",
  "candiivulpix",
  "Canopaa",
  "CaptainConer",
  "captainlights",
  "CaramelExpert59",
  "cardinroo",
  "CareBearKarliTV",
  "careye",
  "CarlyPumpkin",
  "CarnivalCow",
  "CarrieSprout",
  "CarterPJ",
  "Catrinformation",
  "CeliaRAT",
  "CerealTomato",
  "Cernunnos280",
  "ChairX_",
  "charlesispi",
  "Charliebubblegum",
  "charm_y3",
  "chcw",
  "CheByrechik",
  "CheddarE",
  "CheesyMcRibby",
  "Chiara_00",
  "Chiffoi",
  "ChimeraSea",
  "Chiolite",
  "chloq",
  "chrislaban",
  "CisiCisiC",
  "Civilmeowmeow",
  "CleverlyStupid",
  "CocoTakumi",
  "ColbytheWolby",
  "ColeRoll",
  "conee",
  "COOLMOIVE24",
  "corblii",
  "Corporal_Jerry",
  "CorsairPotato",
  "Coulrs",
  "Countess0327",
  "cperc",
  "CrabbySleet3973",
  "Craftulu",
  "Crester_Craft",
  "Crusty435",
  "CrystalFang",
  "Cumi",
  "Cupcake6583",
  "cupOfGlass",
  "CustomExen",
  "Cvssiopeia",
  "Cy11",
  "Cyamusite",
  "Cyan_Ryu",
  "cyzz_",
  "da_monster_man",
  "Dachribal",
  "Daigrock",
  "daldott",
  "DalisVibing",
  "Dalrae",
  "Daltom",
  "Dan1k091132_",
  "DangerZone904",
  "darkleonard2",
  "darkskylord69",
  "DaTorchicPlayz",
  "dbsr1975",
  "DeadlyBoop",
  "deathrobloxian",
  "DecentGG",
  "Decxie",
  "Deedogs3742",
  "Deery",
  "Defnd",
  "Demirioo",
  "denisrabbits",
  "denkfout",
  "DerpDurCake",
  "DerpGTX",
  "DerpyFoxPlayz",
  "DesiDucky",
  "DeviHT",
  "dey_dreams",
  "DEYAA__H",
  "DiegoRdz",
  "DiizyMan",
  "Disorded",
  "DivineCreator",
  "Dono1harm",
  "DontTouchMyLife",
  "doodlexy",
  "DoopliGhost_",
  "DoppleDaddy",
  "Dowdens",
  "Dr_Padenski",
  "DrawnUnicorn631",
  "Drea2819",
  "Dream_Wisp",
  "DreChozen",
  "DrEvilsin",
  "dsate3",
  "dtnglo",
  "Duck_lmao",
  "Duckmain",
  "duckyluv",
  "duckynunu",
  "dummymajor",
  "Duzzza",
  "DVNone",
  "dvzixe",
  "Dylpyckles",
  "easyyuser",
  "EBOYCHAR",
  "EdHed",
  "Edweirdo87",
  "eggypoopoo",
  "ein_Holzkopf",
  "ElappoGamingYT",
  "ElDeathly",
  "elijah2589",
  "Elinii",
  "Elite1_1",
  "Elle33Heart",
  "Elyssen",
  "emilol",
  "emilroos",
  "EmilyOoi",
  "EminenceNShadows",
  "EmsMimi",
  "emsytart",
  "Epic_Facha",
  "EricSamme",
  "ermordete",
  "Estrellada",
  "EternalSunbear",
  "Etx_9",
  "Euraiyle",
  "EvelynIsAnOnion",
  "Everlynixx",
  "evesforrealz",
  "EvieBreevy",
  "Exc0mm",
  "Exquillity",
  "Faazazel",
  "fakeminecraftgf",
  "fallbirds",
  "FancyObiWan",
  "FatMonkeyKing",
  "fawries",
  "Fennik_td",
  "FerretStew",
  "fiiini",
  "FinlyKai",
  "Fistopop",
  "Flaccoz",
  "FlashyPig",
  "flcme",
  "Fleaket",
  "fliight",
  "Flindinho",
  "FloraKiiro",
  "flowerchld",
  "foinks",
  "Foolating",
  "Foxily",
  "FOXYIK",
  "fqln",
  "FrankyXXV",
  "Freshavocado0s",
  "FrontDeskLady",
  "Frotsey",
  "Frozenman",
  "Fryla",
  "Funtime333",
  "gabnonymous",
  "Gabs3030",
  "Galistic",
  "Gamdon",
  "GameIvan46",
  "GamingDucky",
  "GamingPrimos131",
  "GangstaAnt",
  "gdst",
  "GEMC",
  "GemeRyZ",
  "GeneralRoute",
  "GhettoHongky",
  "GizmoThePro",
  "glittryvirgo",
  "Goggleko",
  "GoIdenKnight",
  "Goncal0_",
  "GoodIceBear",
  "GOOEYBOY",
  "GoofyGeek",
  "Gooneev",
  "GracefulSlumber",
  "Grenexus",
  "grissemand123",
  "grschrLight",
  "Guon_",
  "H4jper",
  "haewonnnn",
  "Halocakii",
  "hann1ekin",
  "Hansite",
  "HansKinski",
  "Harazi_",
  "haumios",
  "HayIs4Hailey",
  "Haywolf_Gaming",
  "Hazse",
  "Healanii",
  "HeIIedonna",
  "Helmi_C",
  "Hengrove",
  "HeyItsJackM8",
  "highego",
  "HighRefreshRate",
  "HiiFren",
  "HiImCC",
  "HikaOKLM",
  "Hiratina",
  "HobarT551",
  "Hobikage",
  "Honeybee39",
  "honeyplantt",
  "hoppy819",
  "hotsaucebeats",
  "HouseofJuniper",
  "hpneybee",
  "HuiRen12",
  "HuliLan",
  "Hurcos",
  "Huskel",
  "HydroMC_",
  "HyperrVy",
  "iBeum",
  "IceyMim",
  "iEmmarie",
  "IGiveUpAtNames",
  "ihaltam",
  "iisolarwing",
  "IKTH",
  "illegalPie",
  "im_astepman",
  "Imkayzie",
  "ImKreet",
  "Inaudibley",
  "infernalily",
  "InfinateDreams",
  "Inforcerr",
  "Innaterook",
  "insanesam9",
  "isaacmc12",
  "isislimpinha",
  "Islandish",
  "ItsArrzee",
  "ItsEssieBee",
  "itsmegneko",
  "ItsMusketz",
  "ItsNaira",
  "itsTsunamiCat",
  "ItzzHanVT",
  "IzanitaManzanita",
  "Izice_",
  "izzyisswagger",
  "JackIsAnIdiot",
  "JaJoep",
  "Jakeroly",
  "Jamhalo",
  "jaredy00",
  "JasmineGamez",
  "Jawunleashed",
  "jaykey2227",
  "Jeonar",
  "JerryBS",
  "jessica49",
  "Jholl_",
  "JoesBizzareMama",
  "Jogg",
  "John_Fortnlte",
  "JojoDaYoyo",
  "jojoslices",
  "jojosolos",
  "jontop05",
  "JorgeSword",
  "Joshmanikus",
  "jpd07",
  "jpsm322",
  "JR_Prime",
  "Jsnop",
  "jubileee",
  "Judyloon",
  "Juli3887",
  "JuliYatta",
  "junstrivia",
  "Jupugsa",
  "JustAnzia",
  "JustAthena",
  "JustIcey22",
  "JustJorja",
  "JustLaurita",
  "JustMel65",
  "JustQuacko",
  "KaczeKaczek",
  "Kaeiis",
  "kaffnip",
  "KairiNuu",
  "kaleste",
  "kami_lotik",
  "kamiiix",
  "kasixna",
  "Kat_the_Chimera",
  "katelynsarahxx",
  "KateyElise021",
  "kaychiru",
  "KayRotz",
  "KayyMC",
  "KhaosKorps",
  "KikuAlayne",
  "kimchiu",
  "KingBayne",
  "Kissinger",
  "kitakyu",
  "Klathulimancer",
  "KokoNataa",
  "komaiii",
  "Koniri",
  "Korulein",
  "kosvy",
  "Kovix254",
  "Kroftmen_x7",
  "Krystalsg",
  "Ksidi",
  "kurohaise",
  "Kusak4be",
  "kyleighcake",
  "laalaaleela",
  "Labno",
  "lakeshore5",
  "LaKitty101",
  "LanceWhy",
  "Larbloo",
  "LargoN_Balboa",
  "laura_kill_you",
  "laurvin",
  "LaytzTBE",
  "lazys",
  "LeCheesey",
  "LegHair",
  "LegoFriend",
  "Lessodds",
  "LevelArzt",
  "Levente00____",
  "Lexiliy",
  "leylinka",
  "LGWaffle",
  "Lianam",
  "Lianeu",
  "Libly",
  "LifeIsPatato",
  "lightrocket2",
  "LilHapa",
  "LilithLuvsYa",
  "lillianjl",
  "LinariaMun_Kin",
  "Lingulini",
  "LittlePoohBearr",
  "LizzeMaguire",
  "LlamaSticks",
  "LocutisBorgCube",
  "Loeufys",
  "Lokayy",
  "LolEgirl",
  "LonelyMinotaur7",
  "Longbuds",
  "LooLooPlus",
  "Lopa",
  "LorBuddha",
  "LordBaconNugget",
  "Lordendermen",
  "Lothmeer",
  "LTalk",
  "LuciusTheFoolish",
  "lucyburger",
  "LuhviKyu",
  "LukaTV939",
  "Lumoniam",
  "Lunaoculus",
  "luvcatss",
  "Lynnyxx",
  "LyraTheDrunk",
  "LyteNCrypt",
  "M0SHi_M00",
  "Ma1sy",
  "maenniee",
  "Magetro21",
  "magicsings",
  "MagmaSolo",
  "Mahala_Pink",
  "Maiki_",
  "MajesticFizzi",
  "Malkshake",
  "maltebossking67",
  "manazelfkndazel",
  "Marciismx",
  "Marian_143",
  "Mariitv",
  "Martineli_47",
  "martucarp",
  "MaryIsHere_",
  "Maskyzee",
  "MasterDrey",
  "MasterPaco",
  "MasterYou5",
  "MatchaFoxVR",
  "Mateodlb06",
  "matthew0605",
  "Mavac",
  "mayfol",
  "Meenuhh",
  "MegaMeat_MC",
  "Megamuncher75",
  "Mel1403",
  "MelBun13",
  "MelissMines",
  "Melizsa",
  "Mermilke",
  "Mewella",
  "MIA0005",
  "MiaTwintania",
  "Microspr",
  "MidnightMadnessx",
  "MidnightZ168",
  "Minegan999",
  "MinerTasha",
  "Minesuklaa",
  "MioRhythm",
  "MissSpacePants",
  "Mitchellangeio",
  "Mitzefy",
  "MiyukiShioru",
  "MiyuNijiiro",
  "Molyhydra",
  "MommMercy",
  "Mommy3240",
  "monkeyzeus1",
  "monstera_fox",
  "Montlwyrm",
  "Moodyne",
  "Mookachuu",
  "MoonBunny30",
  "Mooncakexo",
  "MoonRaySK",
  "mooTMZ",
  "MouseyEnder",
  "mouthfulofmiIk",
  "mp_5_9",
  "MPBilegt",
  "Mr_Rempel",
  "MrMoonLanding",
  "ms_Kats",
  "MS_Mounts",
  "munchie_obj",
  "munchytaco",
  "Muraneez",
  "Mxcking",
  "MystHartz",
  "Mythical001",
  "MythicLuna",
  "n00laa",
  "NAJT",
  "Namit__",
  "naniodyy",
  "Narnia",
  "Naxilion",
  "naynay954",
  "necialex",
  "Necroncraft",
  "neoning",
  "Neptsune",
  "Nerdgazmic",
  "NgoWay",
  "Niagiri",
  "nicksteel01",
  "Nifrira",
  "NightieYT",
  "Nightshadow1154",
  "ninageee",
  "Nixolay",
  "nocrypa",
  "NoDeal",
  "NolanCat",
  "Nominalgravy",
  "Nopaa",
  "Norbinio",
  "northeness",
  "Northernside",
  "NotDivine_",
  "NotHydra_",
  "NotJano",
  "NotSoSerious2",
  "NotVico",
  "NovaLegacy13",
  "NovumChase",
  "nuggetsgang",
  "nuhzyyyy",
  "Nullus_1",
  "NulPac",
  "nyaukii",
  "NyeBuoi",
  "Nysily",
  "Oblivion7852",
  "Oceana13",
  "oceann8",
  "oGarfield",
  "OGChiknNuggies",
  "Oglittlehippie",
  "OhItsPiper",
  "okbuni",
  "olsbuh",
  "opcl",
  "opvlent",
  "OrangeDogArts",
  "Osymandes",
  "Ouss3409",
  "Owiethe",
  "OwnEight",
  "OxyCGolem",
  "Ozzie750",
  "P1nkyP4nda18",
  "PaoMiaw",
  "Parrm",
  "PassionPig",
  "PastelleShadow",
  "Pautx",
  "PC_Cycle",
  "Phantrump",
  "phoefi",
  "Pikach_us",
  "PinkieElle",
  "piplupso",
  "pipluVT",
  "pIscript",
  "PixelmonGirl",
  "PlebCS",
  "Plebiain",
  "pohke",
  "Pomcheck",
  "potatopawz",
  "pqlv",
  "predii",
  "PrincessPinecone",
  "prolix",
  "Pseudii",
  "psyomnix",
  "Puffachoo",
  "PunchBag",
  "punkqween",
  "puoz",
  "Purple_T0ast",
  "PurplH0sEr",
  "pyqz",
  "qTaiwan",
  "Qu1nten",
  "QueenEllaBean",
  "Queeni3_",
  "r4yzi",
  "r_3nder",
  "Rabbity11",
  "rahws",
  "rainbowgirl1",
  "Rainnnnnnnnnnnn",
  "rainwet",
  "Ralph",
  "Ramseyer",
  "RatTactics_",
  "RavenYT",
  "realmunyi",
  "Reaper131",
  "Rebecka",
  "Reccoss",
  "RedDuke45",
  "Redlive",
  "regsitaa",
  "ReinFantasy",
  "rezeirl",
  "RhymeTheRapper",
  "RIngenious",
  "RMF1002",
  "RobTipsTV",
  "Rockess",
  "RogueGlitch",
  "Rorachh",
  "RoseRocketYT",
  "RoseTheGuy",
  "Rotivenos",
  "rotonde",
  "rotsurge",
  "RoyalGoogy",
  "RoyalPear_",
  "Rozwellian",
  "RubbishNotTrash",
  "RubyPlaysTV",
  "rusty_courage",
  "Rvin_Mudbone",
  "Rwssia",
  "RynniBee",
  "RYZZIE_1337",
  "sachizu",
  "Sadaze",
  "Saiikotic",
  "Sajjal_N",
  "Sakrey",
  "salmahayek",
  "Salmonazo",
  "Sams",
  "saniixd",
  "SAR0CK",
  "sardina_",
  "SatelliteSelina",
  "schpood",
  "Scorch3103",
  "scotteh",
  "Screenless",
  "Scuttles_225",
  "Sdxxxt_",
  "Sealeh",
  "SeekerOWisdom",
  "Selestialz",
  "SenpaiDejv",
  "Seodrific",
  "serendipityplays",
  "setwria",
  "SexySmokey",
  "Sh1ro_07",
  "Sharese",
  "shayellow",
  "SHeep003",
  "Shekai",
  "shelby395",
  "shimbigail",
  "ShinyPikachu",
  "Shonyx",
  "shotbyalexa",
  "ShoxxyLul",
  "ShrubsRugs",
  "Shxnji",
  "SildenIda",
  "SimpSam",
  "SirEzran",
  "SitzKrieg0",
  "Skeke1",
  "Skucc",
  "sky_dragon_24",
  "SleepySloth_99",
  "sleierslimeHD",
  "Slicknts",
  "SlideSide",
  "Slimey64",
  "SlushieVRC",
  "Snackaroniii",
  "snailpirate",
  "SnapsR",
  "sneakytt",
  "snusu",
  "soda33",
  "SOMANEN",
  "SomeoneNamedEd",
  "SomeSugarBoi",
  "Soniced",
  "Soupports",
  "Sp1cy_cheese",
  "sp33dygonzales77",
  "Spacdogi",
  "Space_Squeakers",
  "Spark2200",
  "Spellcrafter54",
  "SpicyLuna",
  "spiritwolf33333",
  "spookydog_66",
  "spvre",
  "Squ1nz",
  "Squibee",
  "squinkles",
  "Squirtle2021",
  "StanVee",
  "stardustm00n",
  "Starrfrog",
  "StarVeon97",
  "stellarxoxo",
  "StillDreams777",
  "StillnotLilly",
  "stratospherex",
  "Stravilight",
  "StrawberryHolly",
  "Stromoto",
  "Stuffyjoe",
  "Styne",
  "subscribemrbeast",
  "SunsetMagic",
  "Sunwishi",
  "superdudeman75",
  "superduperbro",
  "SuperMango28",
  "superminerJG",
  "supertrooper394",
  "SurgePlugs",
  "SUVIKA",
  "Sweeter67",
  "Swifyz",
  "Swight",
  "swillee",
  "swyshi",
  "Sydnoii",
  "T3Z2",
  "Taasin",
  "Taenyaki",
  "taffyforever",
  "TaneeshaHogan",
  "TangentAbyss674",
  "taxi_zab",
  "tayaruss",
  "taytte",
  "TearsFromV",
  "Terrandth",
  "That_Abyss_Egg",
  "That_Ozzy",
  "Thatderpdoe123",
  "THE_DRIFTER_823",
  "The_Ford_",
  "The_Kings_Ghost",
  "TheBigNo",
  "TheCanadianCooki",
  "TheFshy",
  "TheLunarLex",
  "TheNerdyGeek17",
  "TheOneChaira",
  "ThePetrichoral",
  "TheRealVintage",
  "TheRedEclipse",
  "TheSadGuy1",
  "TheSaphy",
  "Timdecoole123",
  "tizzari",
  "toby8889",
  "TofuPrincess",
  "TomatoPaste_",
  "tonedPipes",
  "Tooz_",
  "torinoemi",
  "toroc4t",
  "tortillamonster_",
  "Toxictaco25",
  "toxumi",
  "tr2sh",
  "Trabss",
  "TradeFav444",
  "TrashTripp",
  "TripleLion",
  "TrueAR",
  "TrueRecluse",
  "tsuneluse",
  "Tuppeeyy",
  "TurboPiggyYT",
  "Turret1XD",
  "twistyn0odle",
  "tzd",
  "ubhi",
  "Utiba",
  "vairywings",
  "VanBrickenBrock",
  "vBlaster",
  "Velis_",
  "velvux",
  "Vengeance82",
  "Vevibelle",
  "Vexnzo",
  "Viancyy",
  "vicklerick",
  "Vik_the_Viking",
  "Vilorence",
  "VindicatorFrag",
  "Vinnyzz",
  "VioletFire43",
  "VioletOcean",
  "VirentTarot",
  "Virin1",
  "vorpaelyzis",
  "vvjellyfish",
  "Vyliaa",
  "W1izX__",
  "Waazix19",
  "Wahlund",
  "Warden_InDark",
  "weckman06",
  "WeebyCraft",
  "Weedyoz",
  "werewolfs4lifes",
  "Weseley",
  "whim5y",
  "wiigg1es",
  "WildAgent47",
  "Wilkman",
  "WindyBea",
  "WithyCreeps",
  "wojcake",
  "Wolfscale",
  "WooshuRandom",
  "Wylltea",
  "wynforthewin",
  "x_Lancer_x",
  "x_stormi_x",
  "xAkacjax",
  "XLR8FX",
  "XoSodaXo",
  "xPhil79x",
  "xq_a",
  "xTeffax",
  "xxKaYotiC",
  "XXKXNG",
  "XxMakio",
  "xXSaltRatXx",
  "Xymusus",
  "Xziob",
  "Yakibear",
  "Yekoi",
  "ymis",
  "YokaSiri",
  "YokingRice",
  "YouLuckyDuck",
  "Youngson_A",
  "YourStandard",
  "YPTA__",
  "YsSavitar",
  "Yummy_Twinkies",
  "YummyYaamiiii",
  "YunaNanase02",
  "yuskan",
  "YuwenEffie",
  "yviaa",
  "zaroman",
  "zavvygamer",
  "zcani",
  "ZeoliteX",
  "ZER0_7EVEN",
  "ZeSnowy",
  "ZFDfilms",
  "Zigy",
  "Zinclly",
  "zolizo89",
  "zombcal",
  "zombreyy",
  "Zucch1n1Loaf",
  "ZumaTGW",
  "Zurius3",
  "zyephy",
  "zzodiaxee"
];
const FACTIONS = [
  "The Peak",
  "HD Clan",
  "Greeko Boys",
  "Men in Suits",
  "Civ Event Veterans",
  "Goober Bay",
  "The Pharaonate",
  "Ironcrest Clan",
  "Boys Next Door",
  "F.U.N. Fellas",
  "The Archivists' Library",
  "The Blue Order",
  "Domnul University",
  "DUDE CITY",
  "The Egalitarian Order",
  "None / Unassigned"
];
const API = "/.netlify/functions/assignments";

function headURL(name, size=100) {
  return `https://minotar.net/helm/${encodeURIComponent(name)}/${size}.png`;
}

const grid = document.getElementById("grid");
const template = document.getElementById("cardTemplate");
const exportBtn = document.getElementById("exportBtn");
const importFile = document.getElementById("importFile");

function makeCard(name, assignedFaction, idx) {
  const node = template.content.firstElementChild.cloneNode(true);
  const nameEl = node.querySelector(".name");
  const tagEl = node.querySelector(".faction-tag");
  const img = node.querySelector(".head");
  const select = node.querySelector(".select");

  nameEl.textContent = name;
  tagEl.textContent = assignedFaction || "None / Unassigned";
  node.title = assignedFaction ? `Faction: ${assignedFaction}` : "Faction: None / Unassigned";
  img.src = headURL(name, 100);
  img.alt = name + " head";

  select.innerHTML = FACTIONS.map(f => `<option value="${f}">${f}</option>`).join("");
  select.value = assignedFaction || "None / Unassigned";

  function openEditor() { node.classList.add("editing"); select.focus(); }
  function closeEditor() { node.classList.remove("editing"); }

  nameEl.addEventListener("click", openEditor);
  node.addEventListener("keydown", (e) => { if (e.key === "Enter") openEditor(); });

  node.querySelector(".save").addEventListener("click", async () => {
    const chosen = select.value === "None / Unassigned" ? "" : select.value;
    // optimistic UI
    tagEl.textContent = chosen || "None / Unassigned";
    node.title = chosen ? `Faction: ${chosen}` : "Faction: None / Unassigned";
    closeEditor();
    try {
      const res = await fetch(API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, faction: chosen })
      });
      if (!res.ok) throw new Error(await res.text());
    } catch (e) {
      alert("Save failed. Reloading…");
      location.reload();
    }
  });

  node.querySelector(".cancel").addEventListener("click", closeEditor);
  return node;
}

async function loadAll() {
  const res = await fetch(API, { cache: "no-store" });
  if (!res.ok) throw new Error("Failed to load assignments");
  return res.json();
}

async function init() {
  const assignments = await loadAll();
  const frag = document.createDocumentFragment();
  NAMES.forEach((name, i) => {
    const card = makeCard(name, assignments[name] || "", i);
    frag.appendChild(card);
  });
  grid.appendChild(frag);
}

exportBtn.addEventListener("click", async () => {
  const map = await loadAll();
  const blob = new Blob([JSON.stringify(map, null, 2)], { type:"application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "assignments.json";
  a.click();
  setTimeout(() => URL.revokeObjectURL(url), 1000);
});

importFile.addEventListener("change", async (e) => {
  const file = e.target.files?.[0];
  if (!file) return;
  try {
    const text = await file.text();
    const map = JSON.parse(text);
    const res = await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ bulk: map })
    });
    if (!res.ok) throw new Error(await res.text());
    location.reload();
  } catch (err) {
    alert("Import failed: " + err.message);
  } finally { e.target.value = ""; }
});

init();
